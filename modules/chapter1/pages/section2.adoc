= Lab: Deploying Your AI Supply Chain
:navtitle: The Model Registry Lab
:toc: macro

// Antora metadata
:page-role: hands-on-lab
:description: Step-by-step guide to deploying the registry, ingesting a model, and connecting the catalog.

[.lead]
*Theory is over. It is time to build.*

In this lab, you will take on the role of a **Lead Platform Engineer**. Your Data Science team has been downloading models randomly from Hugging Face. Your task is to establish order by deploying a **Private Model Registry** and forcing all future deployments to go through this governed gate.

[IMPORTANT]
.Prerequisites
====
* **Cluster Access:** You are logged into an OpenShift AI 3.0 cluster via terminal (`oc login`).
* **Permissions:** You have `cluster-admin` or sufficient namespace privileges.
* **Repository:** You have cloned the course repository:
+
[source,bash]
----
  git clone https://github.com/RedHatQuickCourses/rhoai3-registry.git
  cd rhoai3-registry/
----
====

== Step 1: Dependent Infrastructure

The Model Registry is stateless. Before we can turn it on, we need two things: a **Brain** (Database) and a **Vault** (Object Storage).

We have provided a script that deploys a MySQL 8.0 instance and a MinIO object store into a new namespace called `rhoai-model-registry-lab`.

. **Run the Setup Script:**
+
[source,bash]
----
chmod u+x ./deploy/setup.sh

./deploy/setup.sh
----

Make sure you run the additional output command to set the model registry DB secret.

. **Verify the Pods:**
Ensure the database and storage are running before proceeding.
+
[source,bash]
----
oc get pods -n rhoai-model-registry-lab
----
+
*Expected Output:*
----
NAME                              READY   STATUS    RESTARTS   AGE
mysql-5d8f7-xyz                   1/1     Running   0          45s
minio-7b9c2-abc                   1/1     Running   0          45s
s3-ui-6d87f-rst.                  1/1     Running   0          20s
----

== Step 2: Link the Model Registry to the Database

Edit the name field to change the name of the Model Registry

[source,bash]
----
cat <<EOF | oc apply -f -
apiVersion: modelregistry.opendatahub.io/v1beta1
kind: ModelRegistry
metadata:
  name: model-registry-lab 
  namespace: rhoai-model-registries   
spec:
  grpc:
    port: 9090
  rest:
    port: 8080
  mysql:
    # NETWORK BRIDGE: We use the full DNS name to reach the lab namespace
    host: "mysql.rhoai-model-registry-lab.svc.cluster.local"
    port: 3306
    database: "sampledb"
    username: "admin"
    passwordSecret:
      name: "registry-db-secret"
      key: "database-password"
    sslMode: "disable"
      
  # (Optional) If using Postgres instead of MySQL, use the 'postgres' block instead.
EOF 
----

You can check the OpenShift AI UI or run this command to verify that model registry is working as designed. 

[source,bash]
----
oc get modelregistries.modelregistry.opendatahub.io -n rhoai-model-registries  
----


== Next Step

Now that the Model Registry is running, it is empty.

You will run an automation pipeline that mimics a secure supply chain:

 1.  **Downloads** the `Qwen3-0.6B` model from Hugging Face (or uses a cached local copy).
 2.  **Uploads** the weights to your private MinIO "Vault" (ensuring sovereignty).
 3.  **Registers** the metadata (Version 1.0.0, Author: You) into the MySQL "Brain."


. **Execute the Pipeline:**
+
[source,bash]
----
chmod u+x ./deploy/run_pipeline.sh

./deploy/run_pipeline.sh
----

. **Observe the Output:**
Watch the logs. You should see the "Handshake" happen:
+
[source,text]
----
> Connecting to Hugging Face... Done.
> Downloading 'Qwen3-0.6B'... Done.
> Uploading to Private MinIO Bucket (s3://private-models)... Success.
> Registering with Model Registry API...
> SUCCESS: Model Registered with ID: 12345
----

== Step 3: The Payoff (Connecting the Catalog)

At this moment, the model is safe in your registry, but the Data Scientists cannot see it yet. The **Model Catalog** in the RHOAI Dashboard is still showing only the public Red Hat default models.

---
